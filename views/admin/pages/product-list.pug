extends ../layouts/default.pug
include ../mixins/options.pug

block main
  h1.box-title Quản lý sản phẩm

  if message
    .alert.alert-info #{message}

  //- Bộ lọc
  .section-4
    .inner-wrap
      .inner-item.inner-label
        <i class="fa-solid fa-filter"></i> Bộ lọc
      .inner-item
        select(filter-status)
          option(value="") Trạng thái
          option(value="active") Hoạt động
          option(value="inactive") Tạm dừng
      .inner-item
        select(filter-created-by)
          option(value="") Người tạo
          each item in accountAdminList
            option(value=item.id) #{item.fullName}
      .inner-item.inner-date
        input(type="date" filter-start-date)
        span -
        input(type="date" filter-end-date)
      .inner-item
        select(filter-category)
          option(value="") Danh mục
          +options(categoryTree, 0)
      .inner-item.inner-reset(filter-reset)
        <i class="fa-solid fa-rotate-left"></i> Xóa bộ lọc

  //- Hành động + tìm kiếm
  .section-5
    .inner-wrap
      .inner-change-status(
        change-multi 
        data-api=`/${pathAdmin}/product/change-multi`
      )
        .inner-item
          select
            option(value="") -- Hành động --
            option(value="active") Hoạt động
            option(value="inactive") Dừng hoạt động
            option(value="delete") Xóa
        .inner-item
          button Áp dụng
      .inner-search
        <i class="fa-solid fa-magnifying-glass"></i>
        input(type="text" placeholder="Tìm kiếm" search)
      .inner-button-create
        a(href=`/${pathAdmin}/product/create`) + Tạo mới
      .inner-button-trash
        a(href=`/${pathAdmin}/product/trash`) Thùng rác

  //- Danh sách sản phẩm
  .section-6
    .table-2
      table
        thead
          tr
            th(class="inner-center")
              input(type="checkbox" class="inner-check" check-all)
            th Tên sản phẩm
            th Ảnh đại diện
            th Giá
            th Tồn kho
            th Vị trí
            th(class="inner-center") Trạng thái
            th Tạo bởi
            th Cập nhật bởi
            th Hành động
        tbody
          if productList.length > 0
            each item in productList
              tr
                td(class="inner-center")
                  input(type="checkbox" class="inner-check" check-item=item.id)
                td #{item.name}
                td
                  if item.avatar
                    img(src=item.avatar class="inner-avatar")
                td
                  if typeof item.price === 'number'
                    div Giá gốc: #{item.price.toLocaleString("vi-VN")}đ
                  if typeof item.salePrice === 'number'
                    div KM: #{item.salePrice.toLocaleString("vi-VN")}đ
                td #{item.stock || 0}
                td #{item.position}
                td(class="inner-center")
                  if item.status == "active"
                    .badge.badge-green Hoạt động
                  else if item.status == "inactive"
                    .badge.badge-red Tạm dừng
                td
                  div #{item.createdByFullName}
                  div.inner-time #{item.createdAtFomat}
                td
                  div #{item.updatedByFullName}
                  div.inner-time #{item.updatedAtFomat}
                td
                  .inner-buttons
                    a(href=`/${pathAdmin}/product/edit/${item.id}` class="inner-edit")
                      <i class="fa-regular fa-pen-to-square"></i>
                    button(
                      class="inner-delete"
                      button-delete
                      data-api=`/${pathAdmin}/product/delete/${item.id}`
                    )
                      <i class="fa-regular fa-trash-can"></i>
          else
            tr
              td(colspan="10" class="inner-center") Không có sản phẩm nào được tìm thấy

  //- Phân trang
  .section-7
    span(class="inner-label") Hiển thị #{pagination.skip + 1} - #{pagination.skip + productList.length} của #{pagination.totalRecord}
    if pagination.totalPage > 0
      select(class="inner-pagination" pagination)
        - for(let i = 1; i <= pagination.totalPage; i++)
          option(value=i selected=(i == page)) Trang #{i}
